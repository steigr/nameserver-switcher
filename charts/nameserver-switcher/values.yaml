# Default values for nameserver-switcher.

# Deployment type: "Deployment" (default) or "DaemonSet" (scales with CoreDNS)
deploymentType: "Deployment"

# Number of replicas (only used with Deployment)
replicaCount: 1

# CoreDNS pod label selector for co-scheduling (DaemonSet mode)
coreDNS:
  # Enable co-scheduling with CoreDNS
  coSchedule: false
  # Label selector to match CoreDNS pods
  # Example: {"k8s-app": "kube-dns"} for standard kube-dns
  # Or {"app.kubernetes.io/name": "coredns"} for Helm-deployed CoreDNS
  podSelector:
    k8s-app: "kube-dns"
  # Namespace where CoreDNS is deployed
  namespace: "kube-system"

image:
  repository: ghcr.io/steigr/nameserver-switcher
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Service configuration - combine all ports into single service
service:
  # Combine all services (DNS, gRPC, HTTP) into a single service
  combined: true
  # Service type for main service
  type: ClusterIP
  # Annotations for the main service
  annotations: {}
  # Cluster IP address (optional, leave empty for automatic assignment)
  # Example: "10.96.0.100"
  clusterIP: ""

# DNS server configuration
dns:
  # Port for DNS server (UDP and TCP)
  port: 53

# gRPC server configuration
grpc:
  # Port for gRPC server
  port: 5354

# HTTP server configuration (health/metrics)
http:
  # Port for HTTP server
  port: 8080

# Local service (for local traffic only)
localService:
  # Enable a second service with local routing policy
  enabled: false
  # This service will have spec.internalTrafficPolicy: Local
  # Only routes to endpoints on the same node
  annotations: {}
  # Cluster IP address for local service (optional)
  # Example: "10.96.0.101"
  clusterIP: ""

# Pattern matching configuration
patterns:
  # Request patterns - regex patterns to match incoming DNS requests
  # Example: [".*\\.example\\.com$", "^test\\."]
  request: []

  # CNAME patterns - regex patterns to match CNAME responses
  # Example: [".*\\.cdn\\.provider\\.net$"]
  cname: []

# Resolver configuration
resolvers:
  # Request resolver - DNS server for initial non-recursive lookups
  # Example: "8.8.8.8:53"
  request: ""

  # Explicit resolver - DNS server for recursive lookups when CNAME matches
  # Example: "1.1.1.1:53"
  explicit: ""

  # Passthrough resolver - DNS server for requests not matching any request pattern
  # Falls back to request resolver if not set
  # Example: "9.9.9.9:53"
  passthrough: ""

  # No-CNAME-response resolver - DNS server for responses without CNAME records
  # Falls back to request resolver if not set
  # Example: "208.67.222.222:53"
  noCnameResponse: ""

  # No-CNAME-match resolver - DNS server for CNAME responses not matching patterns
  # Falls back to request resolver if not set
  # Example: "208.67.220.220:53"
  noCnameMatch: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
    add:
      - NET_BIND_SERVICE
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000

resources:
  limits:
    cpu: 500m
    memory: 128Mi
  requests:
    cpu: 100m
    memory: 64Mi

# Prometheus monitoring
metrics:
  enabled: true
  serviceMonitor:
    enabled: false
    interval: 30s
    labels: {}

# Liveness probe
livenessProbe:
  httpGet:
    path: /livez
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

# Readiness probe
readinessProbe:
  httpGet:
    path: /readyz
    port: http
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

nodeSelector: {}

tolerations: []

affinity: {}

# Extra environment variables
extraEnv: []

# Extra volume mounts
extraVolumeMounts: []

# Extra volumes
extraVolumes: []

# DNS Policy. Use the node resolver by default.
dnsPolicy: "Default"
